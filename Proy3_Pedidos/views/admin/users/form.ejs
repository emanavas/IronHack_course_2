<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><%= locals.user ? 'Edit User' : 'Create New User' %> - FoodExpress</title>
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="stylesheet" type="text/css" href="/lib_style.css" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="/css/admin.css"
    />
  </head>
  <body class="container-fluid mx-0 px-0">
    <%- include('../../partials/navbar') %>

    <main class="row">
      <%- include('../../partials/sidebar_admin') %>

      <div class="col-lg-8 col-md-12 d-flex flex-column p-4 mx-auto">
        <div class="container-fluid">
          <h1 class="mb-4"><%= locals.user ? 'Edit User' : 'Create New User' %></h1>

          <% if (locals.errors) { %>
          <div class="alert alert-danger" role="alert">
            <%- errors %>
          </div>
          <% } %>

          <form action="<%= locals.user ? '/admin/users/edit/' + user.userId : '/admin/users' %>" method="POST">
            <div class="mb-3">
              <label for="email" class="form-label">Email address</label>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                value="<%= locals.user ? user.email : (locals.oldData ? oldData.email : '') %>"
                required
              />
            </div>
            <div class="mb-3">
              <label for="firstName" class="form-label">First Name</label>
              <input
                type="text"
                class="form-control"
                id="firstName"
                name="firstName"
                value="<%= locals.user ? user.firstName : (locals.oldData ? oldData.firstName : '') %>"
                required
              />
            </div>
            <div class="mb-3">
              <label for="lastName" class="form-label">Last Name</label>
              <input
                type="text"
                class="form-control"
                id="lastName"
                name="lastName"
                value="<%= locals.user ? user.lastName : (locals.oldData ? oldData.lastName : '') %>"
              />
            </div>
            <div class="mb-3">
              <label for="password" class="form-label">Password</label>
              <input
                type="password"
                class="form-control"
                id="password"
                name="password"
                <%= locals.user ? '' : 'required' %>
              />
              <% if (locals.user) { %>
              <small class="form-text text-muted">Leave blank to keep current password.</small>
              <% } %>
            </div>
            <div class="mb-3">
              <label for="role" class="form-label">Role</label>
              <select class="form-control" id="role" name="role" required>
                <option value="client" <%= (locals.user && user.role === 'client') || (locals.oldData && oldData.role === 'client') ? 'selected' : '' %>>Client</option>
                <option value="restaurant_admin" <%= (locals.user && user.role === 'restaurant_admin') || (locals.oldData && oldData.role === 'restaurant_admin') ? 'selected' : '' %>>Restaurant Admin</option>
                <option value="platform_admin" <%= (locals.user && user.role === 'platform_admin') || (locals.oldData && oldData.role === 'platform_admin') ? 'selected' : '' %>>Platform Admin</option>
              </select>
            </div>
            <button type="submit" class="btn btn-primary">
              <%= locals.user ? 'Update User' : 'Create User' %>
            </button>
            <a href="/admin/users" class="btn btn-secondary">Cancel</a>
          </form>
        </div>
      </div>
    </main>
  </body>
</html>
