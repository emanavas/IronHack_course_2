<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - FoodExpress</title>
    <!-- Standard CSS and JS includes -->
    <link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="stylesheet" type="text/css" href="/lib_style.css" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="/css/admin.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        background-color: #f8f9fa;
      }
      
    </style>
  </head>
  <body class="container-fluid mx-0 px-0">
    <!-- Navbar -->
    <%- include('../partials/navbar') %>

    <main class="row">
        <%- include('../partials/sidebar_admin') %>

        <!-- Main Content -->
        <div class="col-lg-8 col-md-12 d-flex flex-column p-4 mx-auto">
          <div class="container-fluid">
            <h1 class="mb-4">Platform Dashboard</h1>

            <!-- Stats Cards -->
            <div class="row g-4">
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-primary h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Total Users</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.userCount || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-success h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Total Restaurants</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.restaurantCount || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-info h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Food Categories</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.categoryCount || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-secondary h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Total Menu Items</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.menuItemsCount || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <a href="/admin/users" class="card text-white bg-dark h-100 text-decoration-none">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Manage Users</h5>
                    <p class="card-text mt-auto">View, create, edit, and delete users.</p>
                  </div>
                </a>
              </div>
            </div>

            <!-- Order Stats -->
            <div class="row g-4 mt-4">
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-warning h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Total Orders</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.totalOrders || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-danger h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Pending Orders</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.pendingOrders || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-info h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Delivered Orders</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto"><%= locals.deliveredOrders || 'N/A' %></h2>
                  </div>
                </div>
              </div>
              <div class="col-lg-3 col-md-6">
                <div class="card text-white bg-dark h-100">
                  <div class="card-body d-flex flex-column">
                    <h5 class="card-title">Total Revenue</h5>
                    <h2 class="card-text display-4 fw-bold mt-auto">$<%= locals.totalRevenue ? locals.totalRevenue.toFixed(2) : '0.00' %></h2>
                  </div>
                </div>
              </div>
            </div>

            <!-- Charts -->
            <div class="row g-4 mt-5">
              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">Orders by Status</div>
                  <div class="card-body">
                    <canvas id="orderStatusChart"></canvas>
                  </div>
                </div>
              </div>
              <div class="col-lg-6">
                <div class="card">
                  <div class="card-header">Restaurants by Category</div>
                  <div class="card-body">
                    <canvas id="restaurantCategoryChart"></canvas>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>

    </main>
    
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        // Order Status Chart
        const orderStatusData = JSON.parse('<%- locals.orderStatusData %>');
        const orderStatusLabels = orderStatusData.map(item => item.status);
        const orderStatusCounts = orderStatusData.map(item => item.count);

        const orderStatusCtx = document.getElementById('orderStatusChart').getContext('2d');
        new Chart(orderStatusCtx, {
          type: 'bar',
          data: {
            labels: orderStatusLabels,
            datasets: [{
              label: '# of Orders',
              data: orderStatusCounts,
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(75, 192, 192, 0.2)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });

        // Restaurant Category Chart
        const restaurantCategoryData = JSON.parse('<%- locals.restaurantCategoryData %>');
        const restaurantCategoryLabels = restaurantCategoryData.map(item => item.category.name);
        const restaurantCategoryCounts = restaurantCategoryData.map(item => item.count);

        const restaurantCategoryCtx = document.getElementById('restaurantCategoryChart').getContext('2d');
        new Chart(restaurantCategoryCtx, {
          type: 'pie',
          data: {
            labels: restaurantCategoryLabels,
            datasets: [{
              label: '# of Restaurants',
              data: restaurantCategoryCounts,
              backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(255, 206, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(255, 159, 64, 0.2)'
              ],
              borderColor: [
                'rgba(255, 99, 132, 1)',
                'rgba(54, 162, 235, 1)',
                'rgba(255, 206, 86, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(153, 102, 255, 1)',
                'rgba(255, 159, 64, 1)'
              ],
              borderWidth: 1
            }]
          }
        });
      });
    </script>
    
  </body>
  <script src="/js/admin.js"></script>
</html>